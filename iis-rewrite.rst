URL Rewrite for IIS
===================

IISでリダイレクトを行うモジュール。
WebPIでインストールできる。

.. highlight: xml

ルールの書き方
--------------

``<rule>`` と ``<condition>`` と ``<action>`` でルールを作る。

ルールパターンの定義::

	<rule>
		<match url="xxx"/>
	</rule>

条件パターンの定義::

	<rule>
		<conditions>
			<add input="xxx" pattern="xxx"/>
		</conditions>
	</rule>

正規表現にマッチした部分文字列は、変換後の文字列で参照できる。
ルールパターンの場合は ``{R:0}`` のようにRで、
条件パターンの場合は ``{C:0}`` のようにCで参照する。

便利な変数がいくつかあり、``{HTTPS}`` はHTTPの場合、**Off** が設定されている。

* `URL書き換えモジュール構成のリファレンス <https://technet.microsoft.com/ja-jp/library/dd939095.aspx>`_

リダイレクトすると401エラーが返る
---------------------------------

サーバがクライアント証明書を要求する場合、
IISサイトの **SSL設定** で **SSLが必要** フラグが必要になるが、
このフラグが有効になっている場合、リダイレクトすると401エラーになってしまう。
クライアント証明書の要求状態(無視、受理、必要)によらず全てエラー。

チェックを外せばエラーは解決して、リダイレクトも問題なく動作する。
両方同時に有効化する方法は分からない。
